<nz-breadcrumb style="margin:16px 0;">
  <nz-breadcrumb-item>Trang chủ</nz-breadcrumb-item>
  <nz-breadcrumb-item>Nghiệp vụ</nz-breadcrumb-item>
  <nz-breadcrumb-item>Nhập</nz-breadcrumb-item>
  <nz-breadcrumb-item>Sửa phiếu nhập</nz-breadcrumb-item>
</nz-breadcrumb>

<div style="padding:24px; background: #fff; min-height: 70vh">
  <form nz-form [formGroup]="importMaterialForm" (ngSubmit)="saveChanges()" autocomplete="off">
    <nz-card style="width:100%;" nzTitle="Nhập vật tư">
      <nz-form-item>
        <nz-form-label [nzSm]="7" [nzXs]="24" nzRequired nzFor="maKho">Kho hàng</nz-form-label>
        <nz-form-control [nzSm]="10" [nzXs]="24">
          <nz-select [nzDisabled]="importMaterialDetails.length > 0" nzShowSearch nzAllowClear
            nzPlaceHolder="Chọn kho hàng" formControlName="maKho" id="maKho">
            <nz-option *ngFor="let item of materialStores" [nzValue]="item.maKho" [nzLabel]="item.tenKho"></nz-option>
          </nz-select>
          <nz-form-explain *ngIf="importMaterialForm.get('maKho').dirty && importMaterialForm.get('maKho').errors">
            <ng-container *ngIf="importMaterialForm.get('maKho').hasError('required')">
              Vui lòng chọn kho hàng!
            </ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="7" [nzXs]="24" nzRequired nzFor="maHM">Hạng mục vật tư</nz-form-label>
        <nz-form-control [nzSm]="10" [nzXs]="24">
          <nz-select [nzDisabled]="importMaterialDetails.length > 0" nzShowSearch nzAllowClear
            nzPlaceHolder="Chọn hạng mục vật tư" formControlName="maHM" id="maHM">
            <nz-option *ngFor="let item of materialItems" [nzValue]="item.maHM" [nzLabel]="item.tenHM"></nz-option>
          </nz-select>
          <nz-form-explain *ngIf="importMaterialForm.get('maHM').dirty && importMaterialForm.get('maHM').errors">
            <ng-container *ngIf="importMaterialForm.get('maHM').hasError('required')">
              Vui lòng chọn hạng mục vật tư!
            </ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="7" [nzXs]="24" nzRequired nzFor="ngayNhap">Ngày nhập</nz-form-label>
        <nz-form-control [nzSm]="10" [nzXs]="24">
          <nz-date-picker formControlName="ngayNhap" [nzPlaceHolder]="'dd/MM/yyyy'" nzFormat="dd/MM/yyyy">
          </nz-date-picker>
          <nz-form-explain
            *ngIf="importMaterialForm.get('ngayNhap').dirty && importMaterialForm.get('ngayNhap').errors">
            <ng-container *ngIf="importMaterialForm.get('ngayNhap').hasError('required')">
              Vui lòng chọn ngày nhập!
            </ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="7" [nzXs]="24" nzFor="maHM">Chiết khấu</nz-form-label>
        <nz-form-control [nzSm]="10" [nzXs]="24">
          <nz-input-number formControlName="chietKhau" [nzMin]="0" [nzMax]="100" [nzStep]="1"
            [nzFormatter]="formatterPercent" [nzParser]="parserPercent"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="7" [nzXs]="24" nzFor="ghiChu">Ghi chú</nz-form-label>
        <nz-form-control [nzSm]="10" [nzXs]="24">
          <textarea nz-input formControlName="ghiChu" id="ghiChu"></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item style="margin-bottom: 0;">
        <nz-form-control nzOffset="7" [nzSm]="10" [nzXs]="24">
          <button type="submit" nz-button nzType="primary" style="margin-right: 1rem;"
            [disabled]="!importMaterialForm.dirty">
            <i nz-icon type="save" theme="outline"></i> Lưu
          </button>
          <button type="button" nz-button nzType="primary" (click)="addImportDetail()">
            <i nz-icon type="plus" theme="outline"></i> Nhập chi tiết
          </button>
        </nz-form-control>
      </nz-form-item>
    </nz-card>
  </form>
  <br />
  <nz-card style="width:100%;" nzTitle="Danh sách chi tiết nhập vật tư" *ngIf="importMaterialDetails.length > 0"
    [ngSwitch]="materialItemId">
    <!-- Xe và vật tư thay thế -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="10">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Model</th>
          <th>Nước sản xuất</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="20%">{{data.tenVT}}</td>
          <td nzWidth="20%">{{data.model}}</td>
          <td nzWidth="20%">{{data.tenNuoc}}</td>
          <td nzWidth="20%">{{data.soLuong}}</td>
          <td nzWidth="20%">{{data.donGia}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Vũ khí trang thiết bị -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="11">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Số khung</th>
          <th>Số máy</th>
          <th>Năm sản xuất</th>
          <th>Phân cấp</th>
          <th>Nguồn gốc</th>
          <th>Số lượng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="15%">{{data.tenVT}}</td>
          <td nzWidth="15%">{{data.soKhung}}</td>
          <td nzWidth="15%">{{data.soMay}}</td>
          <td nzWidth="15%">{{data.namSX | date:'yyyy'}}</td>
          <td nzWidth="15%">{{data.phanCap}}</td>
          <td nzWidth="15%">{{data.nguonGoc}}</td>
          <td nzWidth="10%">{{data.soLuong}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Hàng viện trợ Mỹ -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="12">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Seri</th>
          <th>Hãng sản xuất</th>
          <th>Năm sản xuất</th>
          <th>Model</th>
          <th>Số lượng</th>
          <th>Ghi chú</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="15%">{{data.tenVT}}</td>
          <td nzWidth="15%">{{data.seri}}</td>
          <td nzWidth="15%">{{data.maHang}}</td>
          <td nzWidth="15%">{{data.maNuoc}}</td>
          <td nzWidth="15%">{{data.model}}</td>
          <td nzWidth="10%">{{data.soLuong}}</td>
          <td nzWidth="15%">{{data.ghiChu}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Trang thiết bị cục quân y cấp -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="13">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Nước sản xuất</th>
          <th>Model</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="20%">{{data.tenVT}}</td>
          <td nzWidth="20%">{{data.maNuoc}}</td>
          <td nzWidth="20%">{{data.model}}</td>
          <td nzWidth="20%">{{data.soLuong}}</td>
          <td nzWidth="20%">{{data.donGia}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Hàng tài trợ trong nước -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="14">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Nước sản xuất</th>
          <th>Model</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="20%">{{data.tenVT}}</td>
          <td nzWidth="20%">{{data.maNuoc}}</td>
          <td nzWidth="20%">{{data.model}}</td>
          <td nzWidth="20%">{{data.soLuong}}</td>
          <td nzWidth="20%">{{data.donGia}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Danh mục thể thao văn hóa -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="15">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Hãng sản xuất</th>
          <th>Nước sản xuất</th>
          <th>Model</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="25%">{{data.tenVT}}</td>
          <td nzWidth="15%">{{data.maHang}}</td>
          <td nzWidth="15%">{{data.maNuoc}}</td>
          <td nzWidth="15%">{{data.model}}</td>
          <td nzWidth="15%">{{data.soLuong}}</td>
          <td nzWidth="15%">{{data.donGia}}</td>
        </tr>
      </tbody>
    </nz-table>
    <!-- Danh mục thuốc -->
    <nz-table #basicTable [nzData]="importMaterialDetails" [nzLoading]="loading" [nzShowPagination]="false"
      *ngSwitchCase="16">
      <thead>
        <tr>
          <th>Vật tư</th>
          <th>Nước sản xuất</th>
          <th>Số đăng ký</th>
          <th>Đợt mua</th>
          <th>Số lượng</th>
          <th>Đơn giá</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td nzWidth="25%">{{data.tenVT}}</td>
          <td nzWidth="15%">{{data.maNuoc}}</td>
          <td nzWidth="15%">{{data.soDangKy}}</td>
          <td nzWidth="15%">{{data.dotMua}}</td>
          <td nzWidth="15%">{{data.soLuong}}</td>
          <td nzWidth="15%">{{data.donGia}}</td>
        </tr>
      </tbody>
    </nz-table>
  </nz-card>
</div>